Version 4.1
SHEET 1 2468 2640
WIRE -1536 -400 -1664 -400
WIRE -1248 -400 -1312 -400
WIRE -1536 -320 -1568 -320
WIRE -1248 -320 -1312 -320
WIRE -1536 -240 -1568 -240
WIRE -1248 -240 -1312 -240
WIRE 192 -208 192 -240
WIRE -640 -192 -896 -192
WIRE -576 -192 -640 -192
WIRE -432 -192 -512 -192
WIRE 1056 -192 1056 -240
WIRE 1440 -192 1440 -240
WIRE 1856 -192 1856 -240
WIRE 192 -160 192 -208
WIRE -640 -128 -640 -192
WIRE 1056 -128 1056 -192
WIRE 1440 -128 1440 -192
WIRE 1856 -128 1856 -192
WIRE -896 -64 -896 -192
WIRE -896 -64 -1008 -64
WIRE -800 -64 -896 -64
WIRE -432 -64 -432 -192
WIRE -432 -64 -480 -64
WIRE -352 -48 -352 -80
WIRE -1568 -16 -1568 -32
WIRE 1056 16 1056 -48
WIRE 1440 16 1440 -48
WIRE 1856 16 1856 -48
WIRE -896 32 -896 -64
WIRE -800 32 -896 32
WIRE -400 32 -480 32
WIRE 160 32 160 -16
WIRE 160 32 96 32
WIRE 224 32 224 -16
WIRE 288 32 224 32
WIRE -432 48 -432 -64
WIRE -2208 64 -2384 64
WIRE -2208 128 -2384 128
WIRE -432 128 -432 112
WIRE -432 128 -480 128
WIRE -352 128 -352 48
WIRE -352 128 -432 128
WIRE -272 128 -352 128
WIRE -160 128 -272 128
WIRE -48 128 -80 128
WIRE 96 128 96 32
WIRE 96 128 32 128
WIRE 160 128 96 128
WIRE 288 128 288 32
WIRE 288 128 240 128
WIRE 352 128 288 128
WIRE 416 128 352 128
WIRE 464 128 416 128
WIRE 592 128 464 128
WIRE -352 144 -352 128
WIRE -1760 160 -1888 160
WIRE -1664 160 -1664 -400
WIRE -1664 160 -1760 160
WIRE -1472 160 -1664 160
WIRE 352 160 352 128
WIRE -2208 192 -2384 192
WIRE -1056 208 -1296 208
WIRE 464 208 464 128
WIRE 592 208 592 128
WIRE -1472 224 -1568 224
WIRE -800 224 -848 224
WIRE -400 224 -480 224
WIRE -1056 240 -1136 240
WIRE 352 240 352 224
WIRE -2336 256 -2384 256
WIRE -2208 256 -2256 256
WIRE -2208 320 -2272 320
WIRE -800 320 -816 320
WIRE -464 320 -480 320
WIRE -352 320 -352 240
WIRE -352 320 -464 320
WIRE -1808 336 -1888 336
WIRE -1136 336 -1136 320
WIRE 352 352 352 320
WIRE 464 352 464 288
WIRE 464 352 352 352
WIRE 592 352 592 288
WIRE 592 352 464 352
WIRE -2208 384 -2272 384
WIRE -816 400 -816 320
WIRE -640 400 -640 384
WIRE -640 400 -816 400
WIRE -464 400 -464 320
WIRE -464 400 -640 400
WIRE -1808 416 -1808 336
WIRE -640 448 -640 400
WIRE -1184 464 -1392 464
WIRE -1984 480 -1984 464
WIRE -1056 480 -1120 480
WIRE -1184 496 -1216 496
WIRE -1392 512 -1392 464
WIRE -1216 528 -1216 496
WIRE 192 544 -16 544
WIRE 448 544 256 544
WIRE -2112 560 -2112 480
WIRE -2048 560 -2112 560
WIRE -1984 560 -1984 480
WIRE -1984 560 -2048 560
WIRE -1808 560 -1808 496
WIRE -1808 560 -1984 560
WIRE -1392 608 -1392 592
WIRE -1568 640 -1568 224
WIRE -1056 640 -1056 480
WIRE -1056 640 -1568 640
WIRE -16 640 -16 544
WIRE 176 640 -16 640
WIRE 448 640 448 544
WIRE 448 640 256 640
WIRE 576 672 512 672
WIRE 736 672 640 672
WIRE 448 768 448 640
WIRE 448 768 256 768
WIRE 512 768 512 672
WIRE 512 768 448 768
WIRE 576 768 512 768
WIRE 736 768 736 672
WIRE 736 768 656 768
WIRE 832 768 736 768
WIRE -16 784 -16 640
WIRE -16 784 -112 784
WIRE 192 784 -16 784
WIRE 448 800 256 800
WIRE 512 800 512 768
WIRE -1360 896 -1376 896
WIRE -1360 912 -1376 912
WIRE -1360 928 -1376 928
WIRE -768 928 -768 880
WIRE -1440 944 -1488 944
WIRE -1360 944 -1360 928
WIRE -1360 944 -1376 944
WIRE -1360 960 -1360 944
WIRE -1360 960 -1376 960
WIRE -1392 976 -1392 960
WIRE -1360 976 -1360 960
WIRE -1360 976 -1392 976
WIRE -592 976 -656 976
WIRE 448 976 448 800
WIRE 512 976 448 976
WIRE 592 976 512 976
WIRE 832 976 672 976
WIRE -1392 992 -1392 976
WIRE -896 992 -992 992
WIRE -592 1008 -656 1008
WIRE 512 1008 512 976
WIRE -896 1024 -992 1024
WIRE -592 1040 -656 1040
WIRE -896 1056 -992 1056
WIRE -592 1072 -656 1072
WIRE -1328 1120 -1376 1120
WIRE -1248 1120 -1264 1120
WIRE -1440 1136 -1488 1136
WIRE -1328 1136 -1376 1136
WIRE -1360 1152 -1376 1152
WIRE -1360 1168 -1360 1152
WIRE -1360 1168 -1376 1168
WIRE -1360 1184 -1360 1168
WIRE -1360 1184 -1376 1184
WIRE -1248 1216 -1264 1216
WIRE -1328 1232 -1328 1136
WIRE -1248 1232 -1264 1232
WIRE -1248 1248 -1264 1248
WIRE -1392 1264 -1392 1184
WIRE -1248 1264 -1248 1248
WIRE -1248 1264 -1264 1264
WIRE -1248 1280 -1248 1264
WIRE -1248 1280 -1264 1280
WIRE 560 1280 496 1280
WIRE 816 1280 640 1280
WIRE -1280 1296 -1280 1280
WIRE -1248 1296 -1248 1280
WIRE -1248 1296 -1280 1296
WIRE -1280 1312 -1280 1296
WIRE 160 1344 -32 1344
WIRE 432 1344 240 1344
WIRE 496 1376 496 1280
WIRE 560 1376 496 1376
WIRE 816 1376 640 1376
WIRE 432 1472 432 1344
WIRE 432 1472 240 1472
WIRE 496 1472 496 1376
WIRE 496 1472 432 1472
WIRE 560 1472 496 1472
WIRE 816 1472 640 1472
WIRE -32 1488 -32 1344
WIRE -32 1488 -112 1488
WIRE 176 1488 -32 1488
WIRE 432 1504 240 1504
WIRE 496 1504 496 1472
WIRE 432 1680 432 1504
WIRE 576 1680 432 1680
WIRE 768 1680 656 1680
WIRE 432 1776 432 1680
WIRE 576 1776 432 1776
WIRE 768 1776 656 1776
WIRE 912 1776 848 1776
WIRE 576 1968 512 1968
WIRE 832 1968 656 1968
WIRE 176 2032 -32 2032
WIRE 448 2032 256 2032
WIRE 512 2064 512 1968
WIRE 576 2064 512 2064
WIRE 832 2064 656 2064
WIRE 448 2160 448 2032
WIRE 448 2160 256 2160
WIRE 512 2160 512 2064
WIRE 512 2160 448 2160
WIRE 576 2160 512 2160
WIRE 832 2160 656 2160
WIRE -32 2176 -32 2032
WIRE -32 2176 -128 2176
WIRE 192 2176 -32 2176
WIRE 448 2192 256 2192
WIRE 512 2192 512 2160
WIRE 448 2368 448 2192
WIRE 592 2368 448 2368
WIRE 832 2368 672 2368
WIRE 448 2480 448 2368
WIRE 592 2480 448 2480
WIRE 832 2480 672 2480
WIRE 976 2480 912 2480
FLAG 464 352 0
FLAG 416 128 Vout
FLAG 272 -48 0
FLAG 112 -48 Vdd
FLAG 272 -80 0
FLAG 112 -80 0
FLAG 192 -208 Il_sns
FLAG 1056 16 0
FLAG 1056 -192 Vin
FLAG 1440 16 0
FLAG 1440 -192 Vdd
FLAG 1856 16 0
FLAG 1856 -192 Vcc
FLAG -640 448 0
FLAG -352 -80 Vin
FLAG -1008 -64 Vcc
FLAG 512 880 0
FLAG 512 1088 0
FLAG 832 768 Vout
FLAG 832 976 Il_sns
FLAG -272 128 SW
FLAG -2048 560 0
FLAG -2048 -32 Vcc
FLAG -112 784 Iout_est
FLAG 496 1584 0
FLAG 512 2272 0
FLAG 912 1776 0
FLAG 816 1280 Il_sns
FLAG 816 1376 Vout
FLAG 816 1472 Vin
FLAG 768 1680 Iout_est
FLAG 832 1968 Il_sns
FLAG 832 2064 Vout
FLAG 832 2160 Vin
FLAG 976 2480 0
FLAG 832 2368 Iout_est
FLAG -112 1488 d_R1
FLAG -128 2176 d_R2
FLAG -2384 256 0
FLAG -2384 192 0
FLAG -2384 64 d_R1
FLAG -2384 128 d_R2
FLAG -768 880 Vdd
FLAG -592 976 Il_sns
FLAG -592 1008 Iout_est
FLAG -592 1040 Vin
FLAG -592 1072 Vout
FLAG -1392 992 0
FLAG -1360 896 R1_sel
FLAG -1360 912 R2_sel
FLAG -992 992 R1_sel
FLAG -992 1024 R2_sel
FLAG -1488 944 Q1
FLAG -992 1056 Sigma_sel
FLAG -1392 1264 0
FLAG -1280 1312 0
FLAG -1248 1216 Sigma_sel
FLAG -1248 1232 R2_sel
FLAG -1376 1184 Vcc
FLAG -1264 1136 0
FLAG -1248 1120 R1_sel
FLAG -1488 1136 Q0
FLAG -2272 384 Q1
FLAG -2272 320 Q0
FLAG 224 2208 0
FLAG 224 2144 Vdd
FLAG 208 1520 0
FLAG 208 1456 Vdd
FLAG 224 816 0
FLAG 224 752 Vdd
FLAG -1472 192 0
FLAG -1472 288 0
FLAG -1136 336 0
FLAG -1216 608 0
FLAG -1152 512 0
FLAG -1152 448 Vdd
FLAG -1392 608 0
FLAG -1024 192 0
FLAG -1024 256 Vcc
FLAG -1568 64 0
FLAG -1760 160 Vout_MUX
FLAG -1136 240 Vsaw_gen
FLAG -1568 -320 0
FLAG -1248 -320 Vdd
FLAG -1248 -240 0
FLAG -1568 -160 0
FLAG -848 224 PWM
FLAG -992 224 PWM
SYMBOL ind -64 144 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 8.2µ
SYMBOL cap 336 160 R0
SYMATTR InstName C1
SYMATTR Value 260µ
SYMBOL res -64 112 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 0
SYMBOL res 336 224 R0
SYMATTR InstName R2
SYMATTR Value 5m
SYMBOL res 256 112 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 10m
SYMBOL OpAmps\\AD8410A 192 -48 R270
SYMATTR InstName U1
SYMBOL res 448 192 R0
SYMATTR InstName R4
SYMATTR Value 3.6810
SYMBOL voltage 1056 -144 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value PWL(0 0 500u 0 1m {Vin})
SYMBOL voltage 1440 -144 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value PWL(0 0 500u 0 1m {Vdd})
SYMBOL voltage 1856 -144 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value PWL(0 0 500u 0 1m {Vcc})
SYMBOL PowerProducts\\LTC7060 -640 128 R0
SYMATTR InstName U2
SYMBOL nmos -400 -48 R0
SYMATTR InstName M1
SYMATTR Value BSC050N04LS
SYMBOL cap -448 48 R0
SYMATTR InstName C2
SYMATTR Value 220n
SYMBOL diode -576 -176 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value DFLS160
SYMBOL nmos -400 144 R0
SYMATTR InstName M2
SYMATTR Value BSC016N04LS
SYMBOL res 272 624 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 25k
SYMBOL cap 256 528 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 50p
SYMBOL res 672 752 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 919k
SYMBOL cap 640 656 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value 1n
SYMBOL res 496 784 R0
SYMATTR InstName R8
SYMATTR Value 1.25k
SYMBOL res 496 992 R0
SYMATTR InstName R9
SYMATTR Value 10k
SYMBOL res 688 960 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 410.5k
SYMBOL current 592 208 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName I1
SYMATTR Value PULSE(0 10 2.5m 10n 10n 300u)
SYMBOL Switches\\ADG5404 -2048 256 R0
SYMATTR InstName U5
SYMBOL voltage -1808 400 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value PWL(0 0 1m 0 1.01m 5)
SYMBOL res 256 1328 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 1k
SYMBOL res 656 1456 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 222k
SYMBOL res 480 1488 R0
SYMATTR InstName R13
SYMATTR Value 205
SYMBOL res 672 1664 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 1.2k
SYMBOL OpAmps\\AD8031 224 2112 M0
SYMATTR InstName U7
SYMBOL res 272 2016 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 1k
SYMBOL res 672 2144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 485k
SYMBOL res 496 2176 R0
SYMATTR InstName R18
SYMATTR Value 150
SYMBOL res 688 2352 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value 1.5k
SYMBOL res 656 1360 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R21
SYMATTR Value 350
SYMBOL res 656 1264 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R22
SYMATTR Value 2.4k
SYMBOL res 672 1760 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 120
SYMBOL res 672 2048 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName 250
SYMATTR Value 248.6820
SYMBOL res 688 2464 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value 90
SYMBOL res 672 1952 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R24
SYMATTR Value 2.94k
SYMBOL voltage 752 1776 R270
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V9
SYMATTR Value PWL(0 0 500u 0 1m 1.8)
SYMBOL voltage 816 2480 R270
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value PWL(0 0 500u 0 1m 1.8)
SYMBOL voltage -2240 256 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 1
SYMBOL Region_detection -784 1056 R0
SYMATTR InstName X1
SYMATTR SpiceLine Vcc_param={Vdd}
SYMBOL Digital\\or -1408 864 M0
SYMATTR InstName A1
SYMATTR SpiceLine Vhigh={Vdd*10} Vlow=0 Rout=10m Trise=10n Tfall=10n Ref=2.5
SYMBOL Digital\\and -1408 1088 M0
SYMATTR SpiceLine Vhigh={Vdd*10} Vlow=0 Rout=10m Trise=10n Tfall=10n Ref=2.5
SYMATTR InstName A2
SYMBOL Digital\\or -1296 1184 M0
SYMATTR InstName A3
SYMATTR SpiceLine Vhigh={Vdd*10} Vlow=0 Rout=10m Trise=10n Tfall=10n Ref=2.5
SYMBOL Digital\\inv -1264 1056 M0
SYMATTR InstName A4
SYMATTR SpiceLine Vhigh={Vdd*10} Vlow=0 Rout=10m Trise=10n Tfall=10n Ref=2.5
SYMBOL OpAmps\\AD8031 208 1424 M0
SYMATTR InstName U6
SYMBOL OpAmps\\AD8031 224 720 M0
SYMATTR InstName U8
SYMBOL SpecialFunctions\\sample -1392 192 R0
WINDOW 3 -64 -52 Invisible 2
SYMATTR Value Vhigh=1 Vlow=0 Rout=1u
SYMATTR InstName A5
SYMBOL voltage -1136 224 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value PULSE(.15 1.15 1.5m 2u 0 0 2u)
SYMBOL Comparators\\LT1721 -1152 416 R0
SYMATTR InstName U4
SYMBOL voltage -1216 512 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V8
SYMATTR Value .1
SYMBOL voltage -1392 496 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V10
SYMATTR Value PULSE(0 1 1.5m 2u 0 0 2u)
SYMBOL Comparators\\LT1721 -1024 288 M180
SYMATTR InstName U9
SYMBOL bv -1568 -32 R0
SYMATTR InstName B1
SYMATTR Value V=if(V(Vout_MUX)-.2 > V(Vsaw_gen), Vdd, 0)
SYMBOL SpecialFunctions\\LTC6992-1 -1424 -320 R0
SYMATTR InstName U3
SYMBOL res -1552 -144 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R7
SYMATTR Value 100k
TEXT 1048 -328 Left 2 !.param Vcc=12 Vdd=5 Vin=50 Fsw=500k
TEXT -2456 2536 Left 2 !.tran 3m
