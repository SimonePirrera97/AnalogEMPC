Version 4
SHEET 1 1944 1748
WIRE 496 -784 496 -816
WIRE 496 -736 496 -784
WIRE -1296 -688 -1296 -736
WIRE -1184 -688 -1184 -736
WIRE -1072 -688 -1072 -736
WIRE -176 -688 -176 -736
WIRE -1296 -624 -1296 -688
WIRE -1184 -624 -1184 -688
WIRE -1072 -624 -1072 -688
WIRE -176 -608 -176 -688
WIRE -224 -592 -272 -592
WIRE 464 -544 464 -592
WIRE 464 -544 400 -544
WIRE 528 -544 528 -592
WIRE 592 -544 528 -544
WIRE -1296 -480 -1296 -544
WIRE -1184 -480 -1184 -544
WIRE -1072 -480 -1072 -544
WIRE -176 -448 -176 -528
WIRE 144 -448 -176 -448
WIRE 256 -448 224 -448
WIRE 400 -448 400 -544
WIRE 400 -448 336 -448
WIRE 464 -448 400 -448
WIRE 592 -448 592 -544
WIRE 592 -448 544 -448
WIRE 656 -448 592 -448
WIRE 720 -448 656 -448
WIRE 768 -448 720 -448
WIRE 1008 -448 768 -448
WIRE 1440 -448 1008 -448
WIRE 656 -416 656 -448
WIRE 1008 -416 1008 -448
WIRE 1008 -416 896 -416
WIRE 1104 -416 1008 -416
WIRE -176 -384 -176 -448
WIRE 896 -384 896 -416
WIRE 1104 -384 1104 -416
WIRE -272 -368 -304 -368
WIRE -224 -368 -272 -368
WIRE 768 -368 768 -448
WIRE 656 -336 656 -352
WIRE -176 -224 -176 -304
WIRE 656 -224 656 -256
WIRE 656 -224 -176 -224
WIRE 768 -224 768 -288
WIRE 768 -224 656 -224
WIRE 896 -224 896 -304
WIRE 896 -224 768 -224
WIRE 1104 -224 1104 -304
WIRE 1104 -224 896 -224
WIRE 1440 -144 1440 -448
WIRE 1600 -144 1440 -144
WIRE 1600 -112 1600 -144
WIRE 1168 -64 1040 -64
WIRE 1360 -64 1232 -64
WIRE -192 -32 -320 -32
WIRE 0 -32 -112 -32
WIRE 1440 -32 1440 -144
WIRE -816 -16 -944 -16
WIRE -624 -16 -736 -16
WIRE 784 -16 688 -16
WIRE 1600 0 1600 -48
WIRE 784 16 784 -16
WIRE 112 32 48 32
WIRE 256 32 192 32
WIRE 1040 32 1040 -64
WIRE 1104 32 1040 32
WIRE 1216 32 1168 32
WIRE 1360 32 1360 -64
WIRE 1360 32 1296 32
WIRE 560 64 560 32
WIRE 688 128 688 -16
WIRE 688 128 656 128
WIRE -160 144 -160 96
WIRE 784 144 784 96
WIRE 1232 144 1232 128
WIRE 1360 144 1360 32
WIRE 1360 144 1232 144
WIRE 1440 144 1440 48
WIRE 1440 144 1360 144
WIRE 1600 144 1600 80
WIRE 1600 144 1440 144
WIRE 0 160 0 -32
WIRE 0 160 -128 160
WIRE 48 160 48 32
WIRE 48 160 0 160
WIRE 112 160 48 160
WIRE 464 160 192 160
WIRE 480 160 464 160
WIRE 1040 160 1040 32
WIRE 1168 160 1040 160
WIRE -1168 176 -1168 128
WIRE -624 176 -624 -16
WIRE -624 176 -656 176
WIRE -512 176 -624 176
WIRE -320 176 -320 -32
WIRE -320 176 -432 176
WIRE -192 176 -320 176
WIRE 1344 176 1232 176
WIRE -1504 192 -1536 192
WIRE -1440 192 -1504 192
WIRE -1040 192 -1136 192
WIRE -944 192 -944 -16
WIRE -944 192 -1040 192
WIRE -16 192 -128 192
WIRE 688 192 656 192
WIRE -1200 208 -1376 208
WIRE -512 208 -640 208
WIRE -1504 224 -1536 224
WIRE -1440 224 -1504 224
WIRE -1040 224 -1136 224
WIRE -160 256 -160 208
WIRE 784 256 656 256
WIRE 1440 256 1440 144
WIRE -1168 288 -1168 240
WIRE 784 288 784 256
WIRE 1344 288 1344 176
WIRE -16 304 -16 192
WIRE -1040 336 -1040 224
WIRE -512 336 -512 208
WIRE 560 400 560 368
WIRE 784 400 784 368
WIRE 1344 416 1344 368
WIRE 1440 416 1440 336
WIRE -16 432 -16 384
WIRE -1040 448 -1040 416
WIRE -800 448 -800 400
WIRE -800 448 -848 448
WIRE -848 464 -848 448
WIRE -512 464 -512 416
WIRE -848 528 -848 512
WIRE -800 528 -848 528
WIRE 848 544 768 544
WIRE 1008 544 928 544
WIRE -944 560 -944 192
WIRE -848 576 -896 576
WIRE -800 576 -800 528
WIRE -800 576 -848 576
WIRE -704 576 -800 576
WIRE -672 576 -704 576
WIRE -528 576 -592 576
WIRE 1008 576 1008 544
WIRE -848 592 -848 576
WIRE -704 592 -704 576
WIRE -896 640 -896 624
WIRE -896 640 -944 640
WIRE -848 656 -848 640
WIRE -800 656 -848 656
WIRE -944 672 -944 640
WIRE -800 672 -800 656
WIRE -704 672 -704 656
WIRE -528 688 -528 656
WIRE 1008 688 1008 656
WIRE 1264 800 1248 800
WIRE 1360 800 1328 800
WIRE 768 896 768 544
WIRE 864 896 768 896
WIRE 944 896 864 896
WIRE 1008 896 944 896
WIRE 1200 896 1088 896
WIRE 1248 896 1248 800
WIRE 1248 896 1200 896
WIRE 1264 896 1248 896
WIRE 1360 896 1360 800
WIRE 1360 896 1344 896
WIRE 1408 896 1360 896
WIRE 944 928 944 896
WIRE 1200 928 1200 896
WIRE 864 944 864 896
WIRE 864 1040 864 1008
WIRE 944 1040 944 1008
WIRE 1200 1040 1200 1008
WIRE 1616 1040 1200 1040
WIRE 1008 1120 992 1120
WIRE 1104 1120 1072 1120
WIRE 1264 1120 1248 1120
WIRE 1360 1120 1328 1120
WIRE 656 1168 656 1120
WIRE 768 1184 768 896
WIRE 768 1184 688 1184
WIRE 624 1200 528 1200
WIRE 736 1216 688 1216
WIRE 848 1216 736 1216
WIRE 992 1216 992 1120
WIRE 992 1216 928 1216
WIRE 1008 1216 992 1216
WIRE 1104 1216 1104 1120
WIRE 1104 1216 1088 1216
WIRE 1200 1216 1104 1216
WIRE 1248 1216 1248 1120
WIRE 1248 1216 1200 1216
WIRE 1264 1216 1248 1216
WIRE 1360 1216 1360 1120
WIRE 1360 1216 1344 1216
WIRE 1440 1216 1360 1216
WIRE 144 1232 32 1232
WIRE 1200 1248 1200 1216
WIRE 656 1280 656 1232
WIRE 32 1312 32 1232
WIRE -16 1328 -112 1328
WIRE 1200 1376 1200 1328
WIRE 1200 1376 1104 1376
WIRE 1296 1376 1200 1376
WIRE 1424 1376 1376 1376
WIRE 1616 1376 1616 1040
WIRE 1616 1376 1424 1376
WIRE 1424 1392 1424 1376
WIRE -16 1424 -16 1376
WIRE 32 1424 32 1392
WIRE 32 1424 -16 1424
WIRE 528 1424 528 1200
WIRE 608 1424 528 1424
WIRE 736 1424 736 1216
WIRE 736 1424 688 1424
WIRE 32 1440 32 1424
WIRE 144 1520 32 1520
WIRE 32 1600 32 1520
WIRE -16 1616 -112 1616
WIRE -16 1712 -16 1664
WIRE 32 1712 32 1680
WIRE 32 1712 -16 1712
WIRE 32 1728 32 1712
FLAG 768 -224 0
FLAG -176 -688 Vin
FLAG -224 -320 0
FLAG -224 -544 0
FLAG 1440 416 0
FLAG -16 432 0
FLAG -160 256 0
FLAG -160 96 Vdd
FLAG -512 464 0
FLAG -272 -592 PWM
FLAG -272 -368 PWM_n
FLAG -1296 -480 0
FLAG -1296 -688 Vin
FLAG -1168 128 0
FLAG -1376 240 0
FLAG -1168 288 Vdd
FLAG -1040 448 0
FLAG -1504 192 PWM
FLAG -1504 224 PWM_n
FLAG 1344 416 0
FLAG -1184 -480 0
FLAG -1184 -688 Vdd
FLAG 1200 192 0
FLAG 1200 128 Vdd
FLAG 720 -448 Vout
FLAG 576 -624 0
FLAG 416 -624 Vdd
FLAG 576 -656 0
FLAG 416 -656 0
FLAG 496 -784 Il_sns
FLAG -176 -448 SW
FLAG 1408 896 Il_sns
FLAG 656 1280 Vdd
FLAG -656 176 EA_-
FLAG -640 208 EA_+
FLAG 560 400 0
FLAG 560 32 Vdd
FLAG 688 192 Vout_opamp1
FLAG -704 672 0
FLAG -944 672 0
FLAG -800 400 Vcc
FLAG -800 672 0
FLAG -528 688 0
FLAG -480 640 EA_-
FLAG -480 592 EA_+
FLAG -1072 -480 0
FLAG -1072 -688 Vcc
FLAG 784 400 0
FLAG 656 1120 0
FLAG -320 176 Vout_com_net
FLAG 1040 160 Vout_opamp2
FLAG -1040 192 Vcomp
FLAG 528 1200 Vout_opamp1
FLAG 944 1040 0
FLAG 1440 1216 Vout
FLAG 256 32 Vout_opamp2
FLAG 864 1040 0
FLAG 1424 1456 0
FLAG 32 1440 0
FLAG -112 1328 sw
FLAG 144 1232 gnd_false
FLAG 1104 1376 gnd_false
FLAG 784 144 0
FLAG 32 1728 0
FLAG -112 1616 sw
FLAG 144 1520 gnd_false_2
FLAG 1008 688 gnd_false_2
DATAFLAG -1040 224 ""
DATAFLAG 1296 176 ""
DATAFLAG 1200 -448 ""
DATAFLAG 1344 224 ""
DATAFLAG 736 -480 ""
SYMBOL ind 240 -432 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 8.2µ
SYMBOL cap 640 -416 R0
SYMATTR InstName C1
SYMATTR Value 260µ
SYMBOL res 240 -464 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 7m
SYMBOL res 640 -352 R0
SYMATTR InstName R2
SYMATTR Value 150µ
SYMBOL sw -176 -512 M180
SYMATTR InstName S1
SYMATTR Value my_SW_HS
SYMBOL sw -176 -288 M180
SYMATTR InstName S2
SYMATTR Value my_SW_LS
SYMBOL res 1424 -48 R0
SYMATTR InstName R3
SYMATTR Value 13.3k
SYMBOL cap 1584 -112 R0
SYMATTR InstName C2
SYMATTR Value 1.8n
SYMBOL res 1584 -16 R0
SYMATTR InstName R4
SYMATTR Value 180
SYMBOL res 1424 240 R0
SYMATTR InstName R5
SYMATTR Value 2.49k
SYMBOL cap 1168 16 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 5.6n
SYMBOL res 1312 16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 6.65k
SYMBOL res 208 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 10k
SYMBOL voltage -512 320 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value PWL(0 0 800u 0 2.8m 0.8)
SYMBOL res -416 160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 10k
SYMBOL voltage -1296 -640 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value {Vin}
SYMBOL voltage -16 288 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value PWL(0 0 100u 0 500u 2.5)
SYMBOL cap 1232 -80 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value 150p
SYMBOL Digital\\buf -1376 144 M0
WINDOW 3 8 44 Invisible 2
SYMATTR Value Vhigh=5 Vlow=0
SYMATTR InstName A1
SYMBOL voltage -1040 320 M0
WINDOW 3 17 101 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value PULSE(0.3 {0.3+Vin/30} 0 {1/Fsw-10n} 10n 0 2u)
SYMATTR InstName V4
SYMBOL Comparators\\LT1721 -1168 272 R180
SYMATTR InstName U1
SYMBOL voltage 1344 272 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value PWL(0 0 100u 0 500u 0.8)
SYMBOL voltage -1184 -640 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value {Vdd}
SYMBOL res -96 -48 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 10k
SYMBOL res -720 -32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 10k
SYMBOL res 560 -464 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 15m
SYMBOL OpAmps\\AD8410A 496 -624 R270
SYMATTR InstName U2
SYMBOL res 704 1408 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 350k
SYMBOL current 896 -384 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName I1
SYMATTR Value PWL(0 0 3.5m 0 +1n 5 4.5m 5 +1n 0)
SYMBOL current 1104 -384 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName I2
SYMATTR Value PWL(0 0 7m 0 +1n 5 +1m 5 +1n 0)
SYMBOL Switches\\ADG819 560 208 M0
SYMATTR InstName U3
SYMBOL OpAmps\\AD8031 -160 112 M0
SYMATTR InstName U4
SYMBOL OpAmps\\AD8031 1200 96 M0
SYMATTR InstName U5
SYMBOL cap -720 592 R0
WINDOW 123 24 84 Left 2
SYMATTR Value2 IC = 0
SYMATTR InstName C5
SYMATTR Value 1.3769µ
SYMBOL res -576 560 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 1k
SYMBOL e -944 544 M0
SYMATTR InstName E1
SYMATTR Value 1
SYMBOL sw -800 432 R0
SYMATTR InstName S3
SYMATTR Value my_SW_clamp
SYMBOL sw -800 560 R0
SYMATTR InstName S4
SYMATTR Value my_SW_clamp
SYMBOL e -528 560 M0
SYMATTR InstName E2
SYMATTR Value 56.234K
SYMBOL voltage -1072 -640 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value {Vcc}
SYMBOL voltage 784 272 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V8
SYMATTR Value PWL(0 0 5m 0 +200u 5 +1u 5 +10u 0 +100u 0 +200u 5)
SYMBOL OpAmps\\ADA4891 656 1264 R180
SYMATTR InstName U6
SYMBOL res 752 -384 R0
SYMATTR InstName R14
SYMATTR Value 5
SYMBOL res 1360 880 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 1Meg
SYMBOL res 1184 912 R0
SYMATTR InstName R16
SYMATTR Value 4.12k
SYMBOL cap 1328 784 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C6
SYMATTR Value 470p
SYMBOL res 1104 1200 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 10Meg
SYMBOL cap 1072 1104 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C7
SYMATTR Value 100p
SYMBOL res 1104 880 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R18
SYMATTR Value 68k
SYMBOL res 928 912 R0
SYMATTR InstName R19
SYMATTR Value 680k
SYMBOL cap 848 944 R0
SYMATTR InstName C8
SYMATTR Value 1n
SYMBOL res 208 16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value 10k
SYMBOL voltage 1008 560 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V9
SYMATTR Value 5
SYMBOL res 944 528 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R22
SYMATTR Value 68k
SYMBOL res 1392 1360 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R23
SYMATTR Value 10m
SYMBOL cap 1408 1392 R0
SYMATTR InstName C9
SYMATTR Value 1n
SYMBOL e 32 1296 R0
SYMATTR InstName E3
SYMATTR Value {15m/Vin}
SYMBOL voltage 784 0 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V10
SYMATTR Value PWL(0 0 100u 0 500u 2.5)
SYMBOL res 1360 1200 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R24
SYMATTR Value 1Meg
SYMBOL res 1184 1232 R0
SYMATTR InstName R25
SYMATTR Value 35k
SYMBOL cap 1328 1104 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C10
SYMATTR Value 470p
SYMBOL res 944 1200 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R21
SYMATTR Value 316
SYMBOL e 32 1584 R0
SYMATTR InstName E4
SYMATTR Value {20m/Vin}
TEXT -1440 -1024 Left 2 !.model my_SW_LS SW(Ron = 5m Roff=100Meg Vt=.5 Vh=.1)
TEXT -1440 -1000 Left 2 !.param Vcc=3.3 Vdd=5 Vin=30 Fsw=300k
TEXT -1440 -976 Left 2 !.tran 0 15m 0 100n
TEXT -1440 -1048 Left 2 !.model my_SW_HS SW(Ron = 7m Roff=100Meg Vt=.5 Vh=.1)
TEXT -1440 -1072 Left 2 !.model my_SW_ideal SW(Ron = 1m Roff=500Meg Vt=.5 Vh=.1)
TEXT -1440 -1096 Left 2 !.model my_SW_clamp SW(Ron = 1m Roff=1G Vt=0.01 Vh=.01)
